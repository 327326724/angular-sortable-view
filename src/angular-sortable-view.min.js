!function(a,b){"use strict";function c(a){if(a=a[0],a.previousElementSibling)return b.element(a.previousElementSibling);for(var c=a.previousSibling;null!=c&&1!=c.nodeType;)c=c.previousSibling;return b.element(c)}var d=b.module("sortableView",[]);d.directive("svRoot",[function(){function d(a,b,c){return c?a.x-b.x<0:a.y-b.y<0}var e=Object.create(null);return{restrict:"A",controller:["$scope","$attrs","$interpolate",function(f,g,h){function i(a){return e[a]}function j(a){delete e[a]}function k(){var a={top:document.body.scrollTop,left:document.body.scrollLeft},b={x:a.left-u.left,y:a.top-u.top};p&&p[0].reposition(b),u=a}var l=h(g.svRoot)(f)||f.$id;e[l]||(e[l]=[]);var m,n,o,p,q,r,s=!1;f.$watchCollection(function(){return i(l)},function(a){s=!1;var b=a.map(function(a){return{part:a.getPart().id,y:a.element[0].getBoundingClientRect().top}}),c=Object.create(null);b.forEach(function(a){c[a.part]?c[a.part].push(a.y):c[a.part]=[a.y]}),Object.keys(c).forEach(function(a){c[a].sort(),c[a].forEach(function(b,d){d<c[a].length-1&&b>0&&b===c[a][d+1]&&(s=!0)})})}),this.$moveUpdate=function(a,b,e,f){if(m=[],!n){var g=e[0].getBoundingClientRect();n=f.clone(),n.addClass("sv-placeholder"),n.css({height:g.height+"px",width:g.width+"px"}),f.after(n),f.addClass("ng-hide"),q=f,o=a,p=e}i(l).forEach(function(a){var c=a.element[0].getBoundingClientRect(),e={x:~~(c.left+c.width/2),y:~~(c.top+c.height/2)};(a.element[0].scrollHeight||a.element[0].scrollWidth)&&m.push({element:a.element,q:(e.x-b.x)*(e.x-b.x)+(e.y-b.y)*(e.y-b.y),view:a.getPart(),targetIndex:a.getIndex(),after:d(e,b,s)})});var h=n[0].getBoundingClientRect(),j={x:~~(h.left+h.width/2),y:~~(h.top+h.height/2)};m.push({q:(j.x-b.x)*(j.x-b.x)+(j.y-b.y)*(j.y-b.y),element:n,placeholder:!0}),m.sort(function(a,b){return a.q-b.q}),m.forEach(function(a,b){if(0!==b||a.placeholder)a.element.removeClass("sv-candidate");else{if(r=a,a.after)a.element.after(n);else{var d=c(a.element);d.length>0?d.after(n):a.element.parent().prepend(n)}a.element.addClass("sv-candidate")}})},this.$drop=function(a,b,c){function d(){if(n.remove(),p.remove(),q.removeClass("ng-hide"),m=void 0,n=void 0,c=void 0,p=void 0,q=void 0,r){r.element.removeClass("sv-candidate");var d=a.model(a.scope).splice(b,1),e=r.view===a&&r.targetIndex>b?r.targetIndex-1:r.targetIndex;r.after&&e++,r.view.model(r.view.scope).splice(e,0,d[0]),f.$root.$$phase||f.$apply()}r=void 0}if(c.revert){var e=n[0].getBoundingClientRect();["-webkit-","-moz-","-ms-","-o-",""].forEach(function(a){"undefined"!=typeof p[0].style[a+"transition"]&&(p[0].style[a+"transition"]="all "+c.revert+"ms ease")}),setTimeout(d,+c.revert),p.css({top:e.top+document.body.scrollTop+"px",left:e.left+document.body.scrollLeft+"px"})}else d()},this.addToSortableElements=function(a){i(l).push(a)},this.removeFromSortableElements=function(a){var b=i(l),c=b.indexOf(a);c>-1&&(b.splice(c,1),0===b.length&&j(l))};var t=b.element(a);t.on("scroll",k),f.$on("$destroy",function(){t.off("off",k)});var u={top:document.body.scrollTop,left:document.body.scrollLeft}}]}}]),d.directive("svPart",["$parse",function(a){return{restrict:"A",require:"^svRoot",controller:["$scope",function(a){this.getPart=function(){return a.part},this.$drop=function(b,c){a.$sortableRoot.$drop(a.part,b,c)}}],scope:!0,compile:function(){return{pre:function(b,c,d,e){if(!d.svPart)throw new Error("no model provided");var f=a(d.svPart);if(!f.assign)throw new Error("model not assignable");b.part={id:b.$id,element:c,model:f,scope:b},b.$sortableRoot=e},post:function(){}}}}}]),d.directive("svElement",["$parse",function(a){return{restrict:"A",require:["^svPart","^svRoot"],controller:["$scope",function(a){a.$ctrl=this}],link:function(c,d,e,f){function g(g){function h(a){var b={x:a.clientX+document.body.scrollLeft-p.x,y:a.clientY+document.body.scrollTop-p.y};o[0].reposition(b,!0),f[1].$moveUpdate(i,{x:a.clientX,y:a.clientY},o,d)}if(0==g.button){var i=a(e.svElement)(c);if(i=b.extend({},{tolerance:"pointer",revert:200,containment:"html"},i),i.containment){i.containment=document.querySelector(i.containment);var l=i.containment.getBoundingClientRect()}var m=d,n=d[0].getBoundingClientRect(),o=m.clone();o.addClass("sv-helper").css({left:n.left+document.body.scrollLeft+"px",top:n.top+document.body.scrollTop+"px",width:n.width+"px"}),j.append(o),o[0].reposition=function(a,b){var c=b?0:+this.style.left.slice(0,-2),d=b?0:+this.style.top.slice(0,-2),e=c+a.x,f=d+a.y;l&&(f<l.top+document.body.scrollTop&&(f=l.top+document.body.scrollTop),f+n.height>l.top+document.body.scrollTop+l.height&&(f=l.top+document.body.scrollTop+l.height-n.height),e<l.left+document.body.scrollLeft&&(e=l.left+document.body.scrollLeft),e+n.width>l.left+document.body.scrollLeft+l.width&&(e=l.left+document.body.scrollLeft+l.width-n.width)),this.style.left=e+"px",this.style.top=f+"px"};var p={x:g.clientX-n.left,y:g.clientY-n.top};k.addClass("sv-sorting-in-progress"),k.on("mousemove",h).on("mouseup",function q(){k.off("mousemove",h),k.off("mouseup",q),k.removeClass("sv-sorting-in-progress"),f[0].$drop(c.$index,i)})}}var h={element:d,getPart:function(){return f[0].getPart()},getIndex:function(){return c.$index}};f[1].addToSortableElements(h),c.$on("$destroy",function(){f[1].removeFromSortableElements(h)});var i=d;i.on("mousedown",g),c.$watch("$ctrl.handle",function(a){a&&(i.off("mousedown",g),i=a,i.on("mousedown",g))});var j=b.element(document.body),k=b.element(document.documentElement)}}}]),d.directive("svHandle",function(){return{require:"^svElement",link:function(a,b,c,d){d.handle=b}}}),b.element(document.head).append(["<style>.sv-helper{position: absolute;z-index: 99999;margin: 0 !important;pointer-events: none;}.sv-candidate{}.sv-placeholder{opacity: 0;}.sv-sorting-in-progress{-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;}</style>"].join(""))}(window,window.angular);