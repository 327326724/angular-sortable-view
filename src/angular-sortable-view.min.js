!function(a,b){"use strict";function c(a){if(a=a[0],a.previousElementSibling)return b.element(a.previousElementSibling);for(var c=a.previousSibling;null!=c&&1!=c.nodeType;)c=c.previousSibling;return b.element(c)}var d=b.module("sortableView",[]);d.directive("svRoot",[function(){function d(a,b,c){return c?a.x-b.x<0:a.y-b.y<0}return{restrict:"EA",controller:["$scope",function(e){function f(){var a={top:document.body.scrollTop,left:document.body.scrollLeft},b={x:a.left-p.left,y:a.top-p.top};k&&k[0].reposition(b),p=a}var g=this;this.$connectedViews=[],this.$sortableElements=[];var h,i,j,k,l,m,n=!1;e.$watchCollection(function(){return g.$sortableElements},function(a){n=!1;var b=a.map(function(a){return{part:a.getPart().id,y:a.element[0].getBoundingClientRect().top}}),c=Object.create(null);b.forEach(function(a){c[a.part]?c[a.part].push(a.y):c[a.part]=[a.y]}),Object.keys(c).forEach(function(a){c[a].sort(),c[a].forEach(function(b,d){d<c[a].length-1&&b>0&&b===c[a][d+1]&&(n=!0)})})}),this.$moveUpdate=function(a,b,e,f){if(h=[],!i){var o=e[0].getBoundingClientRect();i=f.clone(),i.addClass("sv-placeholder"),i.css({height:o.height+"px",width:o.width+"px"}),f.after(i),f.addClass("ng-hide"),l=f,j=a,k=e}g.$sortableElements.forEach(function(a){var c=a.element[0].getBoundingClientRect(),e={x:~~(c.left+c.width/2),y:~~(c.top+c.height/2)};(a.element[0].scrollHeight||a.element[0].scrollWidth)&&h.push({element:a.element,q:(e.x-b.x)*(e.x-b.x)+(e.y-b.y)*(e.y-b.y),view:a.getPart(),targetIndex:a.getIndex(),after:d(e,b,n)})});var p=i[0].getBoundingClientRect(),q={x:~~(p.left+p.width/2),y:~~(p.top+p.height/2)};h.push({q:(q.x-b.x)*(q.x-b.x)+(q.y-b.y)*(q.y-b.y),element:i,placeholder:!0}),h.sort(function(a,b){return a.q-b.q}),h.forEach(function(a,b){if(0!==b||a.placeholder)a.element.removeClass("sv-candidate");else{if(m=a,a.after)a.element.after(i);else{var d=c(a.element);d.length>0?d.after(i):a.element.parent().prepend(i)}a.element.addClass("sv-candidate")}})},this.$drop=function(a,b){function c(){m.element.removeClass("sv-candidate"),i.remove(),k.remove(),l.removeClass("ng-hide");var c=a.model(a.scope).splice(b,1),d=m.view===a&&m.targetIndex>b?m.targetIndex-1:m.targetIndex;m.after&&d++,m.view.model(m.view.scope).splice(d,0,c[0]),h=void 0,i=void 0,j=void 0,k=void 0,l=void 0,m=void 0,e.$root.$$phase||e.$apply()}if(m)if(j.revert){var d=i[0].getBoundingClientRect();["-webkit-","-moz-","-ms-","-o-",""].forEach(function(a){"undefined"!=typeof k[0].style[a+"transition"]&&(k[0].style[a+"transition"]="all "+j.revert+"ms ease")}),setTimeout(c,+j.revert),k.css({top:d.top+document.body.scrollTop+"px",left:d.left+document.body.scrollLeft+"px"})}else c()};var o=b.element(a);o.on("scroll",f),e.$on("$destroy",function(){o.off("off",f)});var p={top:document.body.scrollTop,left:document.body.scrollLeft}}]}}]),d.directive("svPart",["$parse",function(a){return{restrict:"A",require:"^svRoot",controller:["$scope",function(a){this.getPart=function(){return a.part},this.$drop=function(b){a.$sortableRoot.$drop(a.part,b)}}],scope:!0,compile:function(){return{pre:function(b,c,d,e){if(!d.svPart)throw new Error("no model provided");var f=a(d.svPart);if(!f.assign)throw new Error("model not assignable");b.part={id:b.$id,element:c,model:f,scope:b},e.$connectedViews.push(b.part),b.$sortableRoot=e},post:function(){}}}}}]),d.directive("svElement",["$parse",function(a){return{restrict:"A",require:["^svPart","^svRoot"],controller:["$scope",function(a){a.$ctrl=this}],link:function(c,d,e,f){function g(g){function h(a){var b={x:a.clientX+document.body.scrollLeft-p.x,y:a.clientY+document.body.scrollTop-p.y};o[0].reposition(b,!0),f[1].$moveUpdate(k,{x:a.clientX,y:a.clientY},o,d)}if(0==g.button){var k=a(e.svElement)(c);if(k=b.extend({},{tolerance:"pointer",revert:200,containment:"html"},k),k.containment){k.containment=document.querySelector(k.containment);var l=k.containment.getBoundingClientRect()}var m=d,n=d[0].getBoundingClientRect(),o=m.clone();o.addClass("sv-helper").css({left:n.left+document.body.scrollLeft+"px",top:n.top+document.body.scrollTop+"px",width:n.width+"px"}),i.append(o),o[0].reposition=function(a,b){var c=b?0:+this.style.left.slice(0,-2),d=b?0:+this.style.top.slice(0,-2),e=c+a.x,f=d+a.y;l&&(f<l.top+document.body.scrollTop&&(f=l.top+document.body.scrollTop),f+n.height>l.top+document.body.scrollTop+l.height&&(f=l.top+document.body.scrollTop+l.height-n.height),e<l.left+document.body.scrollLeft&&(e=l.left+document.body.scrollLeft),e+n.width>l.left+document.body.scrollLeft+l.width&&(e=l.left+document.body.scrollLeft+l.width-n.width)),this.style.left=e+"px",this.style.top=f+"px"};var p={x:g.clientX-n.left,y:g.clientY-n.top};j.on("mousemove",h).on("mouseup",function q(){j.off("mousemove",h),j.off("mouseup",q),f[0].$drop(c.$index)})}}f[1].$sortableElements.push({element:d,getPart:function(){return f[0].getPart()},getIndex:function(){return c.$index}});var h=d;h.on("mousedown",g),c.$watch("$ctrl.handle",function(a){a&&(h.off("mousedown",g),h=a,h.on("mousedown",g))});var i=b.element(document.body),j=b.element(document.documentElement)}}}]),d.directive("svHandle",function(){return{require:"^svElement",link:function(a,b,c,d){d.handle=b}}}),b.element(document.head).append(["<style>.sv-helper{position: absolute;z-index: 99999;margin: 0 !important;pointer-events: none;}.sv-candidate{}.sv-placeholder{opacity: 0;}</style>"].join(""))}(window,window.angular);