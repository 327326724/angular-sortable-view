!function(a,b){"use strict";function c(a){if(a=a[0],a.previousElementSibling)return b.element(a.previousElementSibling);for(var c=a.previousSibling;null!=c&&1!=c.nodeType;)c=c.previousSibling;return b.element(c)}var d=b.module("sortableView",[]);d.directive("svRoot",[function(){function d(a,b,c){return c?a.x-b.x<0:a.y-b.y<0}var e,f=Object.create(null);return{restrict:"A",controller:["$scope","$attrs","$interpolate",function(g,h,i){function j(a){return f[a]}function k(a){delete f[a]}function l(){var a={top:document.body.scrollTop,left:document.body.scrollLeft},b={x:a.left-v.left,y:a.top-v.top};q&&q[0].reposition(b),v=a}var m=i(h.svRoot)(g)||g.$id;f[m]||(f[m]=[]);var n,o,p,q,r,s,t=!1;this.sortingInProgress=function(){return e},g.$watchCollection(function(){return j(m)},function(a){t=!1;var b=a.map(function(a){return{part:a.getPart().id,y:a.element[0].getBoundingClientRect().top}}),c=Object.create(null);b.forEach(function(a){c[a.part]?c[a.part].push(a.y):c[a.part]=[a.y]}),Object.keys(c).forEach(function(a){c[a].sort(),c[a].forEach(function(b,d){d<c[a].length-1&&b>0&&b===c[a][d+1]&&(t=!0)})})}),this.$moveUpdate=function(a,b,f,g){if(e=!0,n=[],!o){var h=f[0].getBoundingClientRect();o=g.clone(),o.addClass("sv-placeholder"),o.css({height:h.height+"px",width:h.width+"px"}),g.after(o),g.addClass("ng-hide"),g.removeClass("sv-visibility-hidden"),r=g,p=a,q=f}j(m).forEach(function(a){var c=a.element[0].getBoundingClientRect(),e={x:~~(c.left+c.width/2),y:~~(c.top+c.height/2)};a.container||!a.element[0].scrollHeight&&!a.element[0].scrollWidth||n.push({element:a.element,q:(e.x-b.x)*(e.x-b.x)+(e.y-b.y)*(e.y-b.y),view:a.getPart(),targetIndex:a.getIndex(),after:d(e,b,t)}),a.container&&!a.element[0].querySelector("[sv-element]")&&n.push({element:a.element,q:(e.x-b.x)*(e.x-b.x)+(e.y-b.y)*(e.y-b.y),view:a.getPart(),targetIndex:0,container:!0})});var i=o[0].getBoundingClientRect(),k={x:~~(i.left+i.width/2),y:~~(i.top+i.height/2)};n.push({q:(k.x-b.x)*(k.x-b.x)+(k.y-b.y)*(k.y-b.y),element:o,placeholder:!0}),n.sort(function(a,b){return a.q-b.q}),n.forEach(function(a,b){if(0!==b||a.placeholder||a.container)0===b&&a.container?(s=a,a.element.append(o)):a.element.removeClass("sv-candidate");else{if(s=a,a.after)a.element.after(o);else{var d=c(a.element);d.length>0?d.after(o):a.element.parent().prepend(o)}a.element.addClass("sv-candidate")}})},this.$drop=function(a,b,c){function d(){if(e=!1,o.remove(),q.remove(),r.removeClass("ng-hide"),n=void 0,o=void 0,c=void 0,q=void 0,r=void 0,s){s.element.removeClass("sv-candidate");var d=a.model(a.scope).splice(b,1),f=s.view===a&&s.targetIndex>b?s.targetIndex-1:s.targetIndex;s.after&&f++,s.view.model(s.view.scope).splice(f,0,d[0]),g.$root.$$phase||g.$apply()}s=void 0}if(c.revert){var f=o[0].getBoundingClientRect();["-webkit-","-moz-","-ms-","-o-",""].forEach(function(a){"undefined"!=typeof q[0].style[a+"transition"]&&(q[0].style[a+"transition"]="all "+c.revert+"ms ease")}),setTimeout(d,+c.revert),q.css({top:f.top+document.body.scrollTop+"px",left:f.left+document.body.scrollLeft+"px"})}else d()},this.addToSortableElements=function(a){j(m).push(a)},this.removeFromSortableElements=function(a){var b=j(m),c=b.indexOf(a);c>-1&&(b.splice(c,1),0===b.length&&k(m))};var u=b.element(a);u.on("scroll",l),g.$on("$destroy",function(){u.off("off",l)});var v={top:document.body.scrollTop,left:document.body.scrollLeft}}]}}]),d.directive("svPart",["$parse",function(a){return{restrict:"A",require:"^svRoot",controller:["$scope",function(a){this.getPart=function(){return a.part},this.$drop=function(b,c){a.$sortableRoot.$drop(a.part,b,c)},a.$ctrl=this}],scope:!0,link:function(b,c,d,e){if(!d.svPart)throw new Error("no model provided");var f=a(d.svPart);if(!f.assign)throw new Error("model not assignable");b.part={id:b.$id,element:c,model:f,scope:b},b.$sortableRoot=e;var g={element:c,getPart:function(){return b.part},container:!0};e.addToSortableElements(g),b.$on("$destroy",function(){e.removeFromSortableElements(g)})}}}]),d.directive("svElement",["$parse",function(a){return{restrict:"A",require:["^svPart","^svRoot"],controller:["$scope",function(a){a.$ctrl=this}],link:function(c,d,e,f){function g(g){function h(a){var b={x:a.clientX+document.body.scrollLeft-q.x,y:a.clientY+document.body.scrollTop-q.y};n[0].reposition(b,!0),f[1].$moveUpdate(i,{x:a.clientX,y:a.clientY},n,d)}if(!f[1].sortingInProgress()&&0==g.button){var i=a(e.svElement)(c);if(i=b.extend({},{tolerance:"pointer",revert:200,containment:"html"},i),i.containment){i.containment=document.querySelector(i.containment);var m=i.containment.getBoundingClientRect()}var n,o=d,p=d[0].getBoundingClientRect();j||(j=f[0].helper),j?(n=j.clone(),n.removeClass("ng-hide"),n.css({left:p.left+document.body.scrollLeft+"px",top:p.top+document.body.scrollTop+"px"}),o.addClass("sv-visibility-hidden")):(n=o.clone(),n.addClass("sv-helper").css({left:p.left+document.body.scrollLeft+"px",top:p.top+document.body.scrollTop+"px",width:p.width+"px"})),k.append(n),n[0].reposition=function(a,b){var c=b?0:+this.style.left.slice(0,-2),d=b?0:+this.style.top.slice(0,-2),e=c+a.x,f=d+a.y,g=n[0].getBoundingClientRect();m&&(f<m.top+document.body.scrollTop&&(f=m.top+document.body.scrollTop),f+g.height>m.top+document.body.scrollTop+m.height&&(f=m.top+document.body.scrollTop+m.height-g.height),e<m.left+document.body.scrollLeft&&(e=m.left+document.body.scrollLeft),e+g.width>m.left+document.body.scrollLeft+m.width&&(e=m.left+document.body.scrollLeft+m.width-g.width)),this.style.left=e+"px",this.style.top=f+"px"};var q={x:g.clientX-p.left,y:g.clientY-p.top};l.addClass("sv-sorting-in-progress"),l.on("mousemove",h).on("mouseup",function r(){l.off("mousemove",h),l.off("mouseup",r),l.removeClass("sv-sorting-in-progress"),f[0].$drop(c.$index,i)}),f[1].$moveUpdate(i,{x:g.clientX,y:g.clientY},n,d)}}var h={element:d,getPart:function(){return f[0].getPart()},getIndex:function(){return c.$index}};f[1].addToSortableElements(h),c.$on("$destroy",function(){f[1].removeFromSortableElements(h)});var i=d;i.on("mousedown",g),c.$watch("$ctrl.handle",function(a){a&&(i.off("mousedown",g),i=a,i.on("mousedown",g))});var j;c.$watch("$ctrl.helper",function(a){a&&(j=a)});var k=b.element(document.body),l=b.element(document.documentElement)}}}]),d.directive("svHandle",function(){return{require:"^svElement",link:function(a,b,c,d){d.handle=b}}}),d.directive("svHelper",function(){return{require:["?^svPart","?^svElement"],link:function(a,b,c,d){if(b.addClass("sv-helper").addClass("ng-hide"),d[1])d[1].helper=b;else{if(!d[0])throw"svHelper is not nested inside svPart or svElement";d[0].helper=b}}}}),b.element(document.head).append(["<style>.sv-helper{position: absolute;z-index: 99999;margin: 0 !important;pointer-events: none;}.sv-candidate{}.sv-placeholder{opacity: 0;}.sv-sorting-in-progress{-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;}.sv-visibility-hidden{visibility: hidden;}</style>"].join(""))}(window,window.angular);